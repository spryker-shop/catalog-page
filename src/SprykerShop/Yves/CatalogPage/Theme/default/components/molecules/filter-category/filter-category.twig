{% extends model('component') %}

{% define config = {
    name: 'filter-category',
    tag: 'filter-category',
} %}

{% define data = {
    filter: null,
    filterPath: null,
    categories: [],
    isEmptyCategoryFilterValueVisible: null
} %}

{% block component %}
    {% if data.categories is not empty %}
        {{parent()}}
    {% endif %}
{% endblock %}

{% block body %}
    {% include molecule('ajax-provider') with {
        class: config.jsName ~ '__url-purify-provider',
        attributes: {
            method: 'POST',
            url: url('search/url-purify'),
        },
    } only %}

    <ul class="menu">
        {% for categoryNode in data.categories %}
            {% set quantity = 0 %}
            {% set hasChildren = categoryNode.children is defined and categoryNode.children is not empty %}

            {% for filterValue in data.filter.values if (filterValue.value == categoryNode.nodeId) %}
                {% set quantity = filterValue.docCount %}
            {% endfor %}

            {% if data.filterPath is not empty %}
                {% set categoryUrl = url(data.filterPath, {categoryPath: (categoryNode.url)}) %}
            {% else %}
                {% set categoryUrl = categoryNode.url | replace({"'": "\\'", '"':'\\"'}) %}
            {% endif %}
            {% if (quantity > 0) or (quantity <= 0 and data.isEmptyCategoryFilterValueVisible == true) %}
                <li class="menu__item {% if hasChildren %}menu__item--has-children-list{% endif %}">
                    <button class="link {{ config.jsName }}__purify-triggers" type="button" {% if quantity == 0 %}disabled="disabled"{% endif %}>
                        {{ categoryNode.name }} ({{ quantity }})
                    </button>

                    {% if hasChildren %}
                        {% include molecule('filter-category', 'CatalogPage') with {
                            data: {
                                filter: data.filter,
                                filterPath: data.filterPath,
                                categories: categoryNode.children,
                                isEmptyCategoryFilterValueVisible: data.isEmptyCategoryFilterValueVisible
                            }
                        } only %}
                    {% endif %}
                </li>
            {% endif %}
        {% endfor %}
    </ul>
{% endblock %}
